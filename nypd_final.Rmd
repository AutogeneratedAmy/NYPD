---
title: "NYPD_Shootings_Analysis"
author: "Amy Franks"
date: "`r Sys.Date()`"
output: html_document
---

```{r}
library(tidyverse)
library(lubridate)

url_in <- "https://data.cityofnewyork.us/api/views/833y-fsy8/rows.csv?accessType=DOWNLOAD"

nypd <- read_csv(url_in)

spec(nypd)

nypd <- nypd %>%
  select(-c(JURISDICTION_CODE, LOCATION_DESC, X_COORD_CD, Y_COORD_CD, Latitude, Longitude, Lon_Lat))

  nypd$OCCUR_DATE <- mdy(nypd$OCCUR_DATE)

colnames(nypd)

summary(nypd)

colSums(is.na(nypd))

#There are large gaps in the data available associated with perpetrator age group, perpetrator sex,
#and perpetrator race. These variables will be analysed for frequency and locations where they have
#been recorded. 

nypd_w_freq <- nypd %>%
  group_by(BORO) %>%
  summarise(n = n()) %>%
  mutate(Freq = n/sum(n))

nypd_w_freq

ggplot(data = nypd, aes(x = BORO)) +
  geom_bar(fill = "darkslategray4")

nypd_count_na <- nypd %>% 
     group_by(BORO) %>% 
     summarise(across(PERP_AGE_GROUP:PERP_RACE,  ~sum(is.na(.))))

nypd_count_na

nypd_count_na <- nypd_count_na %>%
  full_join(nypd_w_freq) %>%
  mutate(percent_missing = PERP_AGE_GROUP /n)%>%
  mutate(percent_recorded = 1 - percent_missing)

nypd_count_na

ggplot(data = nypd_count_na, aes(
  x = BORO, 
  y = n, 
  fill = percent_missing)) +
  geom_bar(stat = "identity", position = "dodge")+
  labs(x = "Boroughs", )


nypd_count_na %>% slice_max(PERP_AGE_GROUP, n = 10)
nypd_count_na %>% slice_min(PERP_AGE_GROUP, n =10)

nypd$day <- wday(nypd$OCCUR_DATE, label = TRUE)

nypd

ggplot(data = nypd, aes(x = day,
)) + 
  geom_bar(fill = "darkslategray4") +
  labs(title = "Count of Shootings Grouped by Day", x = "Day of the Week", y = "Number of Shootings")

nypd = nypd %>%
  replace_na(list(PERP_AGE_GROUP = "N/A", PERP_SEX = "N/A", PERP_RACE = "N/A"))

nypd
summary(lm(nypd$STATISTICAL_MURDER_FLAG ~ nypd$day))

```

